<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>LINE 打卡系統</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="text-align: center; padding: 50px; font-family: sans-serif;">
  <h1>LINE 打卡系統</h1>
  <button onclick="checkIn()">上班</button>
  <button onclick="checkOut()">下班</button>
  <button onclick="askLeave()">請假</button>
  <button onclick="query()">查詢</button>

  <p id="status" style="margin-top: 30px; font-size: 18px;"></p>

  <script>
    const LIFF_ID = "2007506939-vyL2BwJw"; // ← 把這裡替換成你自己的 LIFF ID
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbwhm2LwwnNbAZpyB5WwLF25Z842bDNI7E0ABaU_lv0j_SzefJei55OqzINAVRLeCcd-/exec"; // ← 替換成你的 Web App URL

    // 初始化 LIFF
liff.init({ liffId: LIFF_ID })
  .then(() => {
    if (!liff.isLoggedIn()) {
      liff.login();
    }
  })
      .catch((err) => {
        document.getElementById("status").innerText = "LIFF 初始化失敗：" + err;
      });

    async function checkIn() {
      try {
        const profile = await liff.getProfile();
        const uid = profile.userId;
        sendToSheet("上班", uid);
      } catch (error) {
        document.getElementById("status").innerText = "打卡失敗：" + error;
      }
    }

    async function checkOut() {
      try {
        const profile = await liff.getProfile();
        const uid = profile.userId;
        sendToSheet("下班", uid);
      } catch (error) {
        document.getElementById("status").innerText = "打卡失敗：" + error;
      }
    }

    async function askLeave() {
      try {
        const profile = await liff.getProfile();
        const uid = profile.userId;
        sendToSheet("請假", uid);
      } catch (error) {
        document.getElementById("status").innerText = "申請失敗：" + error;
      }
    }

    async function query() {
      try {
        const profile = await liff.getProfile();
        const uid = profile.userId;
        sendToSheet("查詢", uid);
      } catch (error) {
        document.getElementById("status").innerText = "查詢失敗：" + error;
      }
    }

    function sendToSheet(action, uid) {
      fetch(SHEET_URL, {
        method: "POST",
        body: JSON.stringify({ action: action, userId: uid }),
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("status").innerText = "✅ " + data;
        })
        .catch((err) => {
          document.getElementById("status").innerText = "❌ 發送失敗：" + err;
        });
    }
  </script>
</body>
</html>
